<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HeoCon88 - Cổng Game Giải Trí</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #0B0E14;
            color: #E2E8F0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* Background Effects */
        .bg-glow { position: fixed; width: 100%; height: 100%; z-index: -1; top: 0; left: 0; }
        .blob { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.4; }
        .blob-1 { top: -10%; left: -10%; width: 300px; height: 300px; background: #4f46e5; }
        .blob-2 { bottom: 10%; right: -10%; width: 250px; height: 250px; background: #ec4899; }

        /* Glass Panel */
        .glass-panel {
            background: rgba(21, 26, 35, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        /* Inputs */
        .input-box {
            background: rgba(11, 14, 20, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .input-box:focus-within {
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
            background: rgba(11, 14, 20, 0.9);
        }

        /* Animations */
        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .tab-btn.active { color: white; background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.1); }
        .tab-btn { color: #64748b; border: 1px solid transparent; }

        .hidden { display: none; }
    </style>
</head>
<body class="p-4 relative">

    <!-- Background -->
    <div class="bg-glow">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
    </div>

    <!-- Container -->
    <div class="w-full max-w-[400px] relative z-10">
        
        <!-- Logo -->
        <div class="text-center mb-8 fade-in">
            <div class="w-20 h-20 mx-auto bg-gradient-to-tr from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg shadow-indigo-500/30 mb-4 transform rotate-3 hover:rotate-0 transition duration-300">
                <i class="fa-solid fa-gamepad text-4xl text-white"></i>
            </div>
            <h1 class="text-2xl font-bold text-white tracking-tight">HeoCon88</h1>
            <p class="text-sm text-slate-400 mt-1">Hệ thống giải trí uy tín</p>
        </div>

        <!-- Main Card -->
        <div class="glass-panel rounded-3xl p-1 overflow-hidden fade-in" style="animation-delay: 0.1s;">
            
            <!-- Tabs -->
            <div class="grid grid-cols-2 p-1 gap-1 mb-4">
                <button onclick="switchTab('login')" id="tab-login" class="tab-btn active py-2.5 rounded-xl text-sm font-bold transition-all">Đăng Nhập</button>
                <button onclick="switchTab('register')" id="tab-register" class="tab-btn py-2.5 rounded-xl text-sm font-bold transition-all">Đăng Ký</button>
            </div>

            <div class="p-5 pt-2">
                
                <!-- LOGIN FORM -->
                <div id="form-login" class="space-y-4">
                    <div class="space-y-4">
                        <div class="input-box flex items-center px-4 py-3.5 rounded-xl gap-3">
                            <i class="fa-solid fa-phone text-slate-500 w-5 text-center"></i>
                            <input id="loginPhone" type="tel" placeholder="Số điện thoại" class="bg-transparent border-none outline-none text-white w-full text-sm font-medium placeholder-slate-500">
                        </div>
                        <div class="input-box flex items-center px-4 py-3.5 rounded-xl gap-3">
                            <i class="fa-solid fa-lock text-slate-500 w-5 text-center"></i>
                            <input id="loginPass" type="password" placeholder="Mật khẩu" class="bg-transparent border-none outline-none text-white w-full text-sm font-medium placeholder-slate-500">
                        </div>
                    </div>
                    
                    <div class="flex justify-end">
                        <button onclick="showForgot()" class="text-xs text-indigo-400 font-bold hover:text-indigo-300 transition">Quên mật khẩu?</button>
                    </div>

                    <button onclick="handleLogin()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-indigo-600/30 active:scale-95 transition-all">
                        ĐĂNG NHẬP
                    </button>
                </div>

                <!-- REGISTER FORM -->
                <div id="form-register" class="hidden space-y-4">
                    <div class="space-y-3">
                        <div class="input-box flex items-center px-4 py-3 rounded-xl gap-3">
                            <i class="fa-solid fa-user text-slate-500 w-5 text-center"></i>
                            <input id="regName" type="text" placeholder="Tên hiển thị" class="bg-transparent border-none outline-none text-white w-full text-sm font-medium placeholder-slate-500">
                        </div>
                        <div class="input-box flex items-center px-4 py-3 rounded-xl gap-3">
                            <i class="fa-solid fa-phone text-slate-500 w-5 text-center"></i>
                            <input id="regPhone" type="tel" placeholder="Số điện thoại (ID)" class="bg-transparent border-none outline-none text-white w-full text-sm font-medium placeholder-slate-500">
                        </div>
                        <div class="input-box flex items-center px-4 py-3 rounded-xl gap-3">
                            <i class="fa-solid fa-lock text-slate-500 w-5 text-center"></i>
                            <input id="regPass" type="password" placeholder="Mật khẩu" class="bg-transparent border-none outline-none text-white w-full text-sm font-medium placeholder-slate-500">
                        </div>
                        <div class="input-box flex items-center px-4 py-3 rounded-xl gap-3">
                            <i class="fa-solid fa-check-double text-slate-500 w-5 text-center"></i>
                            <input id="regPass2" type="password" placeholder="Nhập lại mật khẩu" class="bg-transparent border-none outline-none text-white w-full text-sm font-medium placeholder-slate-500">
                        </div>
                        
                        <!-- MÃ GIỚI THIỆU (Logic mới) -->
                        <div class="relative">
                            <div class="input-box flex items-center px-4 py-3 rounded-xl gap-3 border-orange-500/30" id="ref-box">
                                <i class="fa-solid fa-gift text-orange-500 w-5 text-center"></i>
                                <input id="regRef" type="text" placeholder="Mã giới thiệu (Nếu có)" class="bg-transparent border-none outline-none text-orange-400 w-full text-sm font-bold placeholder-slate-500 uppercase">
                            </div>
                        </div>
                    </div>

                    <button onclick="handleRegister()" class="w-full bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-400 hover:to-pink-400 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-orange-500/30 active:scale-95 transition-all">
                        ĐĂNG KÝ NGAY
                    </button>
                </div>

                <!-- FORGOT PASSWORD -->
                <div id="form-forgot" class="hidden text-center py-4">
                    <div class="w-14 h-14 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fa-solid fa-key text-yellow-400 text-xl"></i>
                    </div>
                    <h3 class="text-white font-bold mb-2">Quên mật khẩu?</h3>
                    <p class="text-slate-400 text-xs mb-6 px-4">Vui lòng liên hệ CSKH để được hỗ trợ cấp lại mật khẩu an toàn.</p>
                    
                    <button onclick="window.open('https://t.me/hc88cskh', '_blank')" class="w-full bg-sky-600 hover:bg-sky-500 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 mb-3">
                        <i class="fa-brands fa-telegram"></i> Liên hệ @hc88cskh
                    </button>
                    
                    <button onclick="switchTab('login')" class="text-xs text-slate-400 hover:text-white transition">Quay lại đăng nhập</button>
                </div>

            </div>
        </div>
        
        <p class="text-center text-slate-600 text-[10px] mt-6 font-mono">SECURE SYSTEM v8.1</p>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-5 left-1/2 -translate-x-1/2 glass-panel border-l-4 border-l-indigo-500 text-white px-6 py-3 rounded-xl shadow-2xl flex items-center gap-3 transition-all duration-300 opacity-0 -translate-y-20 z-50 w-max pointer-events-none">
        <i id="toast-icon" class="fa-solid fa-circle-info text-indigo-400"></i>
        <span id="toast-msg" class="text-sm font-medium">Thông báo hệ thống</span>
    </div>

<script>
    const SUPABASE_URL = "https://sfbaytcmpgceapdcdyer.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNmYmF5dGNtcGdjZWFwZGNkeWVyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU1NDQ2MzYsImV4cCI6MjA4MTEyMDYzNn0.DeXO91pcCzQJHMcXTk9Eilcsk9IoGIPzOM-Ube4zRb8";
    const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // AUTO LOGIN CHECK
    if (localStorage.getItem("my_wallet_uid")) {
        window.location.href = "home.html";
    }

    // CHECK URL FOR REFERRAL (Logic mới)
    window.onload = () => {
        const params = new URLSearchParams(window.location.search);
        const refCode = params.get('ref');
        
        if (refCode) {
            // Tự động chuyển sang tab Đăng Ký
            switchTab('register');
            
            // Điền mã giới thiệu và khóa lại
            const refInput = document.getElementById('regRef');
            refInput.value = refCode;
            refInput.readOnly = true;
            
            // Highlight ô nhập
            document.getElementById('ref-box').classList.add('bg-orange-500/10', 'border-orange-500');
            
            showToast("Đã áp dụng mã giới thiệu: " + refCode);
        }
    }

    function switchTab(tab) {
        // Reset Views
        document.getElementById('form-login').classList.add('hidden');
        document.getElementById('form-register').classList.add('hidden');
        document.getElementById('form-forgot').classList.add('hidden');
        
        // Reset Buttons
        document.getElementById('tab-login').className = "tab-btn py-2.5 rounded-xl text-sm font-bold transition-all";
        document.getElementById('tab-register').className = "tab-btn py-2.5 rounded-xl text-sm font-bold transition-all";

        if(tab === 'login') {
            document.getElementById('form-login').classList.remove('hidden');
            document.getElementById('tab-login').className = "tab-btn active py-2.5 rounded-xl text-sm font-bold transition-all";
        } else if (tab === 'register') {
            document.getElementById('form-register').classList.remove('hidden');
            document.getElementById('tab-register').className = "tab-btn active py-2.5 rounded-xl text-sm font-bold transition-all";
        }
    }

    function showForgot() {
        document.getElementById('form-login').classList.add('hidden');
        document.getElementById('form-register').classList.add('hidden');
        document.getElementById('form-forgot').classList.remove('hidden');
    }

    function showToast(msg, type = 'info') {
        const t = document.getElementById('toast');
        document.getElementById('toast-msg').innerText = msg;
        const icon = document.getElementById('toast-icon');
        
        if(type === 'error') {
            t.style.borderLeftColor = '#f43f5e'; // Rose
            icon.className = "fa-solid fa-circle-exclamation text-rose-400";
        } else if (type === 'success') {
            t.style.borderLeftColor = '#10b981'; // Emerald
            icon.className = "fa-solid fa-circle-check text-emerald-400";
        } else {
            t.style.borderLeftColor = '#6366f1'; // Indigo
            icon.className = "fa-solid fa-circle-info text-indigo-400";
        }

        t.classList.remove('opacity-0', '-translate-y-20');
        setTimeout(() => t.classList.add('opacity-0', '-translate-y-20'), 3000);
    }

    // --- REGISTER LOGIC (UPDATED WITH REFERRAL) ---
    async function handleRegister(){
        const name  = document.getElementById("regName").value.trim();
        const phone = document.getElementById("regPhone").value.trim().toUpperCase();
        const pass  = document.getElementById("regPass").value.trim();
        const pass2 = document.getElementById("regPass2").value.trim();
        const refBy = document.getElementById("regRef").value.trim().toUpperCase() || null;

        if(!name || !phone || !pass || !pass2) return showToast("Vui lòng nhập đủ thông tin!", 'error');
        if(pass !== pass2) return showToast("Mật khẩu không khớp!", 'error');

        try {
            // 1. Check if user exists
            const { data: exist } = await db.from("users").select("id").eq("id", phone).maybeSingle();
            if(exist) return showToast("Số điện thoại đã tồn tại!", 'error');

            // 2. Check Referral Code (if entered)
            if (refBy) {
                const { data: refUser } = await db.from("users").select("id").eq("id", refBy).maybeSingle();
                if (!refUser) return showToast("Mã giới thiệu không tồn tại!", 'error');
                if (refBy === phone) return showToast("Không thể tự giới thiệu bản thân!", 'error');
            }

            // 3. Create User
            const { error } = await db.from("users").insert({
                id: phone,
                name: name,
                password: pass,
                ref_by: refBy, // Lưu người giới thiệu
                balance: 0
            });

            if(error) throw error;

            showToast("Đăng ký thành công!", 'success');
            setTimeout(() => {
                switchTab('login');
                document.getElementById('loginPhone').value = phone;
            }, 1500);

        } catch(e) {
            console.error(e);
            showToast("Lỗi đăng ký: " + e.message, 'error');
        }
    }

    // --- LOGIN LOGIC ---
    async function handleLogin(){
        const phone = document.getElementById("loginPhone").value.trim();
        const pass  = document.getElementById("loginPass").value.trim();

        if(!phone || !pass) return showToast("Nhập SĐT và mật khẩu!", 'error');

        try {
            const { data: user, error } = await db.from("users").select("*").eq("id", phone).maybeSingle();
            
            if(error) throw error;
            if(!user || user.password !== pass) return showToast("Sai tài khoản hoặc mật khẩu!", 'error');

            localStorage.setItem("my_wallet_uid", phone);
            showToast("Đăng nhập thành công!", 'success');
            setTimeout(() => window.location.href = "home.html", 1000);

        } catch(e) {
            showToast("Lỗi kết nối!", 'error');
        }
    }
</script>
</body>
</html>

